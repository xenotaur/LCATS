#!/usr/bin/env bash
set -euo pipefail

echo "Coverage for lcats ..."
set -x

# Ensure we start fresh
python -m coverage erase

# Run the same discovery pattern as scripts/test
python -m coverage run -m unittest discover tests "*_test.py"

# Terminal summary (with missing lines)
python -m coverage report -m

# Optional: generate HTML report if requested
if [[ "${1:-}" == "--html" ]]; then
  python -m coverage html
  { set +x; } 2>/dev/null
  echo
  echo "HTML report written to htmlcov/index.html"
  exit 0
fi

{ set +x; } 2>/dev/null
echo
